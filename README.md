# WhatsApp Proxy Server - Updated to New API

## نظرة عامة
تم تحديث خادم البروكسي لاستخدام API جديد لإرسال رسائل WhatsApp يعمل على خادم AWS.

## التغييرات الرئيسية

### 1. تحديث Endpoint
- **القديم:** `http://wa.elliaa.com/send-message`
- **الجديد:** `http://13.51.195.216:3000/api/send-message`

### 2. تحديث المعاملات
- **القديم:** `number` (رقم الهاتف)
- **الجديد:** `phone` (رقم الهاتف)

### 3. تحديث معالجة الاستجابات
- **الاستجابة الناجحة:**
```json
{
  "success": true,
  "messageId": "3EB0C767D8B7A8F9",
  "timestamp": "2025-08-12T15:30:00.000Z",
  "phone": "201234567890@c.us"
}
```

- **الاستجابة الفاشلة:**
```json
{
  "success": false,
  "error": "Failed to send message",
  "message": "Error details"
}
```

### 4. ميزات جديدة
- **راوت جديد:** `GET /api-status` للتحقق من حالة API الجديد
- **معالجة محسنة للأخطاء** مع تنسيق موحد
- **تسجيل محسن** مع معلومات التحديث

## كيفية الاستخدام

### إرسال رسالة
```bash
POST /send-message
Content-Type: application/json

{
  "number": "201234567890",  // سيتم تحويله تلقائياً إلى "phone"
  "message": "مرحباً بك!"
}
```

### التحقق من صحة الخادم
```bash
GET /health
```

### التحقق من حالة API الجديد
```bash
GET /api-status
```

## التثبيت والتشغيل

### المتطلبات
- Node.js >= 14.0.0
- npm أو yarn

### التثبيت
```bash
npm install
```

### التشغيل
```bash
# التشغيل العادي
npm start

# التشغيل في وضع التطوير
npm run dev
```

## التكوين
- **Port:** 3000 (قابل للتغيير عبر متغير البيئة PORT)
- **HTTPS Port:** 443 (قابل للتغيير عبر متغير البيئة HTTPS_PORT)
- **Timeout:** 30 ثانية للطلبات
- **CORS:** مفعل لجميع النطاقات

## ملاحظات مهمة
- الخادم الجديد يعمل على Port 3000
- يجب التأكد من أن WhatsApp متصل على الخادم الجديد
- يدعم الخادم الجديد CORS
- Timeout: 30 ثانية

## استكشاف الأخطاء

### مشاكل الاتصال
- تأكد من أن الخادم الجديد يعمل على `13.51.195.216:3000`
- تحقق من إعدادات الشبكة والجدار الناري

### مشاكل المعاملات
- تأكد من استخدام `number` في الطلب (سيتم تحويله تلقائياً)
- تأكد من صحة تنسيق رقم الهاتف

### مشاكل الاستجابة
- تحقق من تنسيق JSON في الاستجابة
- تأكد من أن API الجديد يعمل بشكل صحيح

## الدعم
للمساعدة أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق التطوير. 